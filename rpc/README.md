Happy to extract this to an RPC lib
